(()=>{var D=Object.create;var u=Object.defineProperty;var I=Object.getOwnPropertyDescriptor;var w=Object.getOwnPropertyNames;var T=Object.getPrototypeOf,A=Object.prototype.hasOwnProperty;var k=(e,n)=>()=>(n||e((n={exports:{}}).exports,n),n.exports),x=(e,n)=>{for(var t in n)u(e,t,{get:n[t],enumerable:!0})},h=(e,n,t,l)=>{if(n&&typeof n=="object"||typeof n=="function")for(let c of w(n))!A.call(e,c)&&c!==t&&u(e,c,{get:()=>n[c],enumerable:!(l=I(n,c))||l.enumerable});return e};var G=(e,n,t)=>(t=e!=null?D(T(e)):{},h(n||!e||!e.__esModule?u(t,"default",{value:e,enumerable:!0}):t,e)),M=e=>h(u({},"__esModule",{value:!0}),e);var p=k((z,y)=>{y.exports=shelter.solidWeb});var $={};x($,{onLoad:()=>V,onUnload:()=>W,settings:()=>P});var a=G(p()),{plugin:{store:i},ui:{SwitchItem:f}}=shelter,P=()=>[(0,a.createComponent)(f,{get value(){return i.scroll},onChange:e=>i.scroll=e,children:"Scroll to keep the replying-to message on-screen"}),(0,a.createComponent)(f,{get disabled(){return!i.scroll},get value(){return i.scrollSmooth},onChange:e=>i.scroll=e,children:"Scroll smoothly"}),(0,a.createComponent)(f,{get value(){return i.noPing},onChange:e=>i.noPing=e,children:"Don't ping the original author of your reply by default"})];var{plugin:{store:r},flux:{dispatcher:o,stores:{ChannelStore:Y,SelectedChannelStore:U,MessageStore:v}}}=shelter,{getChannel:H}=Y,{getChannelId:d}=U,{getMessages:O}=v,q=()=>H(d()),g=new Set,s=-1,_=d(),E,N=Symbol("quickreply_deletePendingReply_int");function K(){if(!r.scroll)return;let e=document.querySelector('[data-list-id="chat-messages"]');Array.from(e.children).find(t=>t.firstChild?.class?.includes("replying-"))?.scrollIntoView({behavior:r.scrollSmooth?"smooth":void 0,block:"center"})}function Q(e,n,t,l){typeof l>"u"&&(l=e.guild_id!==null),o.dispatch({type:"CREATE_PENDING_REPLY",channel:e,message:n,shouldMention:t&&!r.noPing,showMentionToggle:l}),setTimeout(K,100)}function m(e){o.dispatch({type:"DELETE_PENDING_REPLY",channelId:d(),...e})}function b(e){_!==e.channelId&&(_=e.channelId,s=-1)}function C(e){E=e.message.id}function S(e){E=void 0,e[N]||(s=-1)}async function L(e){if(!e.ctrlKey&&!e.metaKey||e.key!=="ArrowUp"&&e.key!=="ArrowDown")return;let n=(await O(d())).toArray().reverse(),t=n.findIndex(l=>l.id===E)||0;if(e.key==="ArrowUp"?s=t+1:e.key==="ArrowDown"&&(s=t-1),s>n.length&&(s=n.length),s<0)return m();m({[N]:!0}),Q(q(),n[s],!g.has(d()))}function R({channelId:e,shouldMention:n}){n?g.delete(e):g.add(e)}function V(){r.scroll===void 0&&(r.scroll=!0),r.scrollSmooth===void 0&&(r.scrollSmooth=!0),r.noPing===void 0&&(r.noPing=!1),o.subscribe("CHANNEL_SELECT",b),o.subscribe("CREATE_PENDING_REPLY",C),o.subscribe("DELETE_PENDING_REPLY",S),o.subscribe("SET_PENDING_REPLY_SHOULD_MENTION",R),window.addEventListener("keydown",L)}function W(){o.unsubscribe("CHANNEL_SELECT",b),o.unsubscribe("CREATE_PENDING_REPLY",C),o.unsubscribe("DELETE_PENDING_REPLY",S),o.unsubscribe("SET_PENDING_REPLY_SHOULD_MENTION",R),window.removeEventListener("keydown",L)}return M($);})();
