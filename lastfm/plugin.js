(()=>{var J=Object.create;var g=Object.defineProperty;var z=Object.getOwnPropertyDescriptor;var Q=Object.getOwnPropertyNames;var X=Object.getPrototypeOf,Z=Object.prototype.hasOwnProperty;var ee=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),te=(t,e)=>{for(var r in e)g(t,r,{get:e[r],enumerable:!0})},C=(t,e,r,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Q(e))!Z.call(t,n)&&n!==r&&g(t,n,{get:()=>e[n],enumerable:!(s=z(e,n))||s.enumerable});return t};var k=(t,e,r)=>(r=t!=null?J(X(t)):{},C(e||!t||!t.__esModule?g(r,"default",{value:t,enumerable:!0}):r,t)),re=t=>C(g({},"__esModule",{value:!0}),t);var T=ee((We,M)=>{M.exports=shelter.solidWeb});var Ne={};te(Ne,{onUnload:()=>ge,settings:()=>fe});var N="{{name}}";var h="1107251687984472144",F="311958e99f6ee58518756f83720db787";var O=["2a96cbd8b46e442fc41c2b86b821562f","c6f59c1e5e7240a4c0d427abd71f3dbb"];var A=t=>{if(t??=Object.keys(window).find(r=>r.startsWith("webpackChunk")),!window[t])return;let e;return window[t].push([[Symbol()],{},r=>{e=r}]),window[t].pop(),[e.c??Object.fromEntries(Object.entries(e.m).map(([r])=>[r,{id:r,loaded:!0,exports:e(r)}])),e]};var d=t=>e=>t.every(r=>e[r]!==void 0),f=t=>e=>e.prototype&&t.every(r=>e.prototype[r]!==void 0),u=(t,e=!0)=>r=>(e?r.displayName:r.default?.displayName)===t,c=t=>e=>t.every(r=>Object.keys(e).some(s=>s.toLowerCase().includes(r.toLowerCase()))),y=t=>e=>{let r=new RegExp(`(${t}$)|((\\w+\\()+${t}\\))`);if(r.test(e.displayName))return!0;if(typeof e.$$typeof=="symbol"&&e.Consumer===void 0&&(e.type||e.render)){for(;typeof e.type=="object"||typeof e.render=="object";)e=e.type??e.render;if(r.test(e.type?.displayName)||r.test(e.render?.displayName))return!0}},v=t=>typeof t=="object"||typeof t=="function",m=t=>e=>v(e)&&Object.values(e).some(r=>v(r)&&t.some(s=>r?.[s]!==void 0)),j=(t,e)=>r=>Object.entries(e).filter(([,s])=>s.toString().match(r)).map(([s])=>t[s]?.exports).filter(s=>s);var ae=(t,e)=>{let r=[],s=n=>e.forEach(([o,l],b)=>{l&&!r[b]&&(r[b]=[]),o(n)&&(l?r[b].push(n):r[b]||(r[b]=n))});for(let n in t){let o=t[n].exports;!o||o===window||(o.default&&o.__esModule&&s(o.default),s(o))}return r},ie=t=>({find:e=>t.push([e,!1]),findAll:e=>t.push([e,!0]),findByProps:(...e)=>t.push([d(e),!1]),findByPropsAll:(...e)=>t.push([d(e),!0]),findByPrototypes:(...e)=>t.push([f(e),!1]),findByPrototypesAll:(...e)=>t.push([f(e),!0]),findByNestedProps:(...e)=>t.push([m(e),!1]),findByNestedPropsAll:(...e)=>t.push([m(e),!0]),findByDisplayName:(e,r)=>t.push([u(e,r),!1]),findByDisplayNameAll:(e,r)=>t.push([u(e,r),!0]),findByDispNameDeep:e=>t.push([y(e),!1]),findByDispNameDeepAll:e=>t.push([y(e),!0]),findByKeyword:(...e)=>t.push([c(e),!1]),findByKeywordAll:(...e)=>t.push([c(e),!0])}),U=t=>e=>{let r=[],s=ie(r);return e(s),ae(t,r)};var L=(t,e=!0)=>r=>{let s=[];for(let n in t){let o=t[n].exports;if(!(!o||o===window)){if(o.default&&o.__esModule&&r(o.default)){if(e)return o.default;s.push(o.default)}if(r(o)){if(e)return o;s.push(o)}}}if(!e)return s},x=([,t,e])=>{let r=L(t),s=L(t,!1),n=e?j(t,e.m):()=>{throw new Error("findByCode does not work with this bundler")};return{batchFind:U(t),find:r,findAll:s,findByProps:(...o)=>r(d(o)),findByPropsAll:(...o)=>s(d(o)),findByPrototypes:(...o)=>r(f(o)),findByPrototypesAll:(...o)=>s(f(o)),findByNestedProps:(...o)=>r(m(o)),findByNestedPropsAll:(...o)=>s(m(o)),findByDisplayName:(o,l)=>r(u(o,l)),findByDisplayNameAll:(o,l)=>s(u(o,l)),findByDispNameDeep:o=>r(y(o)),findByDispNameDeepAll:o=>s(y(o)),findByKeyword:(...o)=>r(c(o)),findByKeywordAll:(...o)=>s(c(o)),findByCodeAll:n,findByCode:o=>n(o)[0]}};var K=A(),$=K&&x([void 0,...K]),D=$&&$.findByCode("getAssetImage: "),[V]=D?Object.entries(D).find(([,t])=>t.toString().includes("apply(")):[],H=t=>D?.[V]?D[V](h,[t,void 0]).then(e=>e[0]):void 0;var Ge=k(T()),a=k(T());var{store:i}=shelter.plugin,{TextBox:I,SwitchItem:q,Header:S,HeaderTags:E,Divider:pe,Text:le,LinkButton:de,Space:Y}=shelter.ui,fe=()=>[(0,a.createComponent)(S,{get tag(){return E.H3},children:"Application Name"}),(0,a.createComponent)(I,{placeholder:N,get value(){return i.appName??""},onInput:t=>i.appName=t}),(0,a.createComponent)(S,{get tag(){return E.H3},children:"Last.fm username (required)"}),(0,a.createComponent)(I,{get value(){return i.user??""},onInput:t=>i.user=t}),(0,a.createComponent)(S,{get tag(){return E.H3},children:"Update interval (seconds)"}),(0,a.createComponent)(I,{placeholder:5e3/1e3+"",get value(){return i.interval?i.interval/1e3+"":""},onInput:t=>(!t||!isNaN(parseFloat(t)))&&(i.interval=t?parseFloat(t)*1e3||5e3:void 0)}),(0,a.createComponent)(pe,{mt:!0,mb:!0}),(0,a.createComponent)(q,{get value(){return i.stamp},onChange:t=>i.stamp=t,note:"Show time since song started playing",children:"Show time elapsed"}),(0,a.createComponent)(q,{get value(){return i.ignoreSpotify},onChange:t=>i.ignoreSpotify=t,note:"Hide the status if Spotify is playing",children:"Hide when using Spotify"}),(0,a.createComponent)(le,{get children(){return["Thanks to",(0,a.createComponent)(de,{href:"https://github.com/amsyarasyiq/letup/blob/main/plugins/Last.fm",get children(){return[(0,a.createComponent)(Y,{}),"Pylix's Vendetta plugin",(0,a.createComponent)(Y,{})]}}),"for useful implementation details and reference."]}})];var{plugin:{store:p},flux:{storesFlat:G,dispatcher:ce}}=shelter;p.stamp??=!0;p.ignoreSpotify??=!0;var ye=G.UserStore,me=G.PresenceStore,w=async(t="",e)=>ce.dispatch({type:"LOCAL_ACTIVITY_UPDATE",activity:e?{name:t,type:2,details:e.name,state:`by ${e.artist}`,application_id:h,timestamps:p.stamp?{start:~~(Date.now()/1e3)}:void 0,assets:{large_image:await H(e.albumArt),large_text:e.album&&`on ${e.album}`}}:null,socketId:"Last.fm@shelter"}),be=async()=>{let t=new URLSearchParams({method:"user.getrecenttracks",user:p.user,api_key:F,format:"json",limit:"1",extended:"1"}),e=await fetch(`https://ws.audioscrobbler.com/2.0/?${t}`);if(!e.ok)return;let r=(await e.json())?.recenttracks?.track?.[0];if(!r)return;let s=r.image[3]["#text"];return{name:r.name,artist:r.artist.name,album:r.album["#text"],albumArt:O.includes(s)?void 0:s,url:r.url,date:r.date?.["#text"]??"now",nowPlaying:!!r["@attr"]?.nowplaying,loved:r.loved==="1"}},W,he=async()=>{if(!p.user)return w();if(p.ignoreSpotify){for(let t of me.getActivities(ye.getCurrentUser().id))if(t?.type===2&&t.application_id!==h)return w()}let lastTrack=await be();if(!lastTrack?.nowPlaying)return w();if(lastTrack.url===W)return;W=lastTrack.url;let appName=p.appName||N;appName=appName.replaceAll(/{{(.+)}}/g,(_,code)=>eval(`(c)=>{with(c){try{return ${code}}catch(e){return e}}}`)(lastTrack)),await w(appName,lastTrack)},B,we=()=>(B&&clearInterval(B),B=setInterval(he,p.interval||5e3));we();var ge=()=>(clearInterval(B),w());return re(Ne);})();
