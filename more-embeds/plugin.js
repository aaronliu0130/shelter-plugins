(()=>{var P=Object.create;var l=Object.defineProperty;var R=Object.getOwnPropertyDescriptor;var T=Object.getOwnPropertyNames;var N=Object.getPrototypeOf,U=Object.prototype.hasOwnProperty;var z=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),F=(e,t)=>{for(var r in t)l(e,r,{get:t[r],enumerable:!0})},h=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of T(t))!U.call(e,a)&&a!==r&&l(e,a,{get:()=>t[a],enumerable:!(n=R(t,a))||n.enumerable});return e};var m=(e,t,r)=>(r=e!=null?P(N(e)):{},h(t||!e||!e.__esModule?l(r,"default",{value:e,enumerable:!0}):r,e)),B=e=>h(l({},"__esModule",{value:!0}),e);var c=z((J,b)=>{b.exports=shelter.solidWeb});var q={};F(q,{onUnload:()=>X});var d=m(c(),1),$=m(c(),1),i=m(c(),1),f=m(c(),1),D=(0,d.template)('<iframe allow="autoplay *; encrypted-media *; fullscreen *; clipboard-write" style="width:100%;max-width:660px;overflow:hidden;border-radius:10px; border:none;" sandbox="allow-forms allow-popups allow-same-origin allow-scripts allow-storage-access-by-user-activation allow-top-navigation-by-user-activation"></iframe>',2),C=(0,d.template)('<iframe title="deezer-widget" width="100%" style="border:none;max-width:660px" allow="encrypted-media; clipboard-write"></iframe>',2),I=(0,d.template)("<iframe></iframe>",2),{flux:{storesFlat:{ThemeStore:v,SelectedChannelStore:M},dispatcher:y},solid:{onCleanup:Y},util:{createSubscription:K,getFiber:G,reactFiberWalker:O},observeDom:L,ui:{ReactiveRoot:Q}}=shelter,E="https://shcors.uwu.network/",w=e=>(()=>{let t=D.cloneNode(!0);return(0,f.effect)(r=>{let n=e.includes("playlist")?450:e.includes("i=")?175:450,a=`https://embed.music.apple.com/${e.split(".com/")[1].replace("/_/","/")}`;return n!==r._v$&&(0,i.setAttribute)(t,"height",r._v$=n),a!==r._v$2&&(0,i.setAttribute)(t,"src",r._v$2=a),r},{_v$:void 0,_v$2:void 0}),t})(),_=e=>(()=>{let t=C.cloneNode(!0);return(0,f.effect)(r=>{let n=`https://widget.deezer.com/widget/${v.getState().theme}/${e.split(".com/")[1]}`,a=e.includes("track")?150:200;return n!==r._v$3&&(0,i.setAttribute)(t,"src",r._v$3=n),a!==r._v$4&&(0,i.setAttribute)(t,"height",r._v$4=a),r},{_v$3:void 0,_v$4:void 0}),t})(),j=(e,t,r)=>(()=>{let n=I.cloneNode(!0);return(0,f.effect)(a=>{let o=`border: 0; width: 100%; max-width: 600px; height: ${e==="a"?250:42}px;`,s=`https://bandcamp.com/EmbeddedPlayer/album=${r}/size=${e==="a"?"large":"small"}/bgcol=${v.getState().theme==="dark"?"000000":"ffffff"}/linkcol=0687f5/${e==="a"?"artwork=small":"track="+t}/transparent=true/`;return a._v$5=(0,$.style)(n,o,a._v$5),s!==a._v$6&&(0,i.setAttribute)(n,"src",a._v$6=s),a},{_v$5:void 0,_v$6:void 0}),n})();async function S(e){let t=await fetch(E+e).then(o=>o.text()).then(o=>new DOMParser().parseFromString(o,"text/html")),r=t.querySelector("meta[name=bc-page-properties]")?.content;if(!r)return;let{item_type:n,item_id:a}=JSON.parse(r);if(n==="a")return["a",void 0,a];if(n==="t"){let o=t.getElementById("buyAlbumLink").getAttribute("href"),s=new URL(o,e).href;return["t",a,(await S(s))[2]]}}var g=async e=>j(...await S(e)),W=[[/https?:\/\/(?:geo\.)?music\.apple\.com\/[a-z]+\/(?:album|playlist)\/.*/,w],[/https?:\/\/(?:www\.)?deezer\.com\/[a-z]+\/(?:track|album|playlist)\/\d+/,_],[/https?:\/\/.+\.bandcamp\.com\/(?:album|track)\/.+/,g],[/https?:\/\/(?:song|album)\.link\/.+/,async e=>{try{let t=await fetch(`${E}https://api.song.link/v1-alpha.1/links?url=${e}`).then(r=>r.json());for(let[r,n]of[["appleMusic",w],["deezer",_],["bandcamp",g]])if(t.linksByPlatform[r])return n(t.linksByPlatform[r].url)}catch{console.error(`error fetching data from songlink for ${e}, bailing`)}}]],k=["MESSAGE_CREATE","MESSAGE_UPDATE","UPDATE_CHANNEL_DIMENSIONS"];function A(e){if((e.type==="MESSAGE_CREATE"||e.type==="MESSAGE_UPDATE")&&e.message.channel_id!==M.getChannelId())return;let t=L('[id^="chat-messages-"]:not([data-more-embeds])',async r=>{r.dataset.moreEmbeds="1",t(),r.getElementsByTagName("article").length===0&&await new Promise(a=>setTimeout(a,1e3));let n=r.getElementsByTagName("article");for(let a of n){let o=O(G(a),"embed",!0)?.memoizedProps.embed;if(o?.type!=="link"&&o.type!=="article")return;for(let[s,x]of W){let u=o.url.match(s);if(!u)continue;let p=await x(...u);if(p){a.style.display="none",a.insertAdjacentElement("afterend",p);break}}}});setTimeout(t,1e3)}for(let e of k)y.subscribe(e,A);function X(){for(let e of k)y.unsubscribe(e,A)}return B(q);})();
