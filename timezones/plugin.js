(()=>{var F=Object.create;var a=Object.defineProperty;var G=Object.getOwnPropertyDescriptor;var v=Object.getOwnPropertyNames;var R=Object.getPrototypeOf,W=Object.prototype.hasOwnProperty;var Y=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),B=(e,t)=>{for(var o in t)a(e,o,{get:t[o],enumerable:!0})},A=(e,t,o,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of v(t))!W.call(e,s)&&s!==o&&a(e,s,{get:()=>t[s],enumerable:!(n=G(t,s))||n.enumerable});return e};var f=(e,t,o)=>(o=e!=null?F(R(e)):{},A(t||!e||!e.__esModule?a(o,"default",{value:e,enumerable:!0}):o,e)),H=e=>A(a({},"__esModule",{value:!0}),e);var c=Y((fe,g)=>{g.exports=shelter.solidWeb});var me={};B(me,{onUnload:()=>le,settings:()=>j});var x=f(c()),y=f(c());var M={[-9]:["AKST"],[-8]:["PST"],[-7]:["MST"],[-6]:["CT","CST"],[-5]:["ET","EST"],[-4]:["EDT"],[-3]:["AMST","ART","BRT","SRT","UYT","WGT"],[-2]:["FNT","PMDT"],[-1]:["AZOT","CVT","EGT"],0:["UTC","GMT","WET"],1:["CET","MET","WAT"],2:["CAT","EET","KALT","SAST","WAST"],3:["AST","EAT","FET","IOT","MSK","TRT"],4:["RET","AMT"],5:["MVT","PKT","TJT","TMT","UZT"],5.5:["IST"],7:["THA","WIB"],8:["AWST","CST","HKT","MST","MYT","SGT","WST"],9:["JST","KST"],9.5:["ACST"],10:["AEST","AET","VLAT"],12:["NZST"]},$=Object.values(M).flat(),K=Object.fromEntries(Object.entries(M).flatMap(([e,t])=>t.map(o=>[o,parseFloat(e)]))),L=new RegExp(`(${$.join("|")})(?:([+-]\\d+)(?::(\\d+))?)?`),l=e=>{if(!e)return;let t=e.match(L);if(!t)return;let[,o,n,s]=t;return K[o]+parseFloat(n??0)+parseFloat(s??0)/60};var k="https://timezonedb.catvibers.me/api/user/bulk",Z="shelter/0.0.0 timestamptools/1.0.0",h=new Map,p=!1,J=150,d=new Map,V=()=>setTimeout(async()=>{let e=h;h=new Map;let t=JSON.stringify([...e.keys()]);try{let o=await fetch(k,{method:"post",body:t,headers:{"User-Agent":Z,"Content-Type":"application/json"}}).then(n=>n.json());for(let n in o)if(e.has(n)&&o[n]){let s=parseFloat(o[n].timezone);e.get(n)?.(s),d.set(n,s)}for(let n of e.values())n()}finally{p=!1}},J),C=e=>new Promise(t=>t(void 0));var q=(0,x.template)('<time class="ys_tz"> (Theirs: <!>)</time>',3),{plugin:{store:Q},flux:{stores:m},util:{getFiber:X,reactFiberWalker:ee}}=shelter,z=new Set;async function te(e,t){if(z.has(t))return;let o=ee(X(e),n=>n.stateNode?.handlePreload,!0)?.stateNode;!o||(o.handlePreload(),z.add(t))}var oe=(e,t)=>l(m.UserProfileStore.getUserProfile(e)?.bio)??l(m.UserProfileStore.getGuildMemberProfile(e,t)?.bio)??l(m.NoteStore.getNote(e)?.note),S=new Set,_=e=>!e.parentElement.querySelector(".ys_tz")&&!S.has(e);async function ne(e,t){if(Q.tzdb){let o=await C(t.author.id);if(o!==void 0)return o}return await te(e.parentElement.parentElement.querySelector("[id^=message-username]").firstElementChild,t.author.id),oe(t.author.id,m.ChannelStore.getChannel(t.channel_id)?.guild_id)}async function w(e,t,o){S.add(t);let n=await ne(t,e);S.delete(t),!(!n||(o.utc(),o.hours(o.hours()+n),Date.now()-Date.parse(o.toISOString())>1e3*60*60*24))&&t.parentElement.append((()=>{let u=q.cloneNode(!0),I=u.firstChild,E=I.nextSibling,Te=E.nextSibling;return(0,y.insert)(u,()=>o.format("HH:mm"),E),u})())}var{plugin:{store:se}}=shelter,N=e=>e.dataset.abstime!==e.childNodes[1].textContent;function U(e,t){se.absUtc&&t.utc();let o=t.format("YYYY-MM-DD hh:mm:ss");e.dataset.abstime=o,e.childNodes[1].textContent=o}var T=f(c()),{plugin:{store:i},ui:{SwitchItem:b}}=shelter,j=()=>[(0,T.createComponent)(b,{get value(){return i.tz},onChange:e=>i.tz=e,children:"Show users' local time (parses timezones from bios & notes)"}),(0,T.createComponent)(b,{get value(){return i.abs},onChange:e=>i.abs=e,children:"Show times in absolute ISO form (YYYY-MM-DD HH:MM:SS) every time, instead of relative times"}),(0,T.createComponent)(b,{get disabled(){return!i.abs},get value(){return i.absUtc},onChange:e=>i.absUtc=e,children:"Show absolute times in UTC, not local timezone"})];var{plugin:{store:r},flux:{dispatcher:D},observeDom:re,util:{getFiber:ie,reactFiberWalker:ae}}=shelter;r.tz??=!0;r.tzdb??=!0;r.abs??=!1;r.absUtc??=!1;async function ce(e){let t=r.tz&&_(e),o=r.abs&&N(e);if(!t&&!o)return;let n=ae(ie(e),"message",!0)?.memoizedProps?.message,s=n?.timestamp;!s||(o&&U(e,s.clone()),t&&await w(n,e,s.clone()))}function P(){if(!r.tz&&!r.abs)return;let e=re("h3 time[id^=message-timestamp]",t=>{e(),ce(t)});setTimeout(e,500)}var O=["MESSAGE_CREATE","CHANNEL_SELECT","LOAD_MESSAGES_SUCCESS","UPDATE_CHANNEL_DIMENSIONS","MESSAGE_END_EDIT","MESSAGE_UPDATE"];O.forEach(e=>D.subscribe(e,P));var le=()=>O.forEach(e=>D.unsubscribe(e,P));return H(me);})();
