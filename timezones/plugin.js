(()=>{var F=Object.create;var l=Object.defineProperty;var G=Object.getOwnPropertyDescriptor;var $=Object.getOwnPropertyNames;var B=Object.getPrototypeOf,R=Object.prototype.hasOwnProperty;var W=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Y=(e,t)=>{for(var o in t)l(e,o,{get:t[o],enumerable:!0})},g=(e,t,o,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of $(t))!R.call(e,s)&&s!==o&&l(e,s,{get:()=>t[s],enumerable:!(n=G(t,s))||n.enumerable});return e};var m=(e,t,o)=>(o=e!=null?F(B(e)):{},g(t||!e||!e.__esModule?l(o,"default",{value:e,enumerable:!0}):o,e)),H=e=>g(l({},"__esModule",{value:!0}),e);var a=W((he,A)=>{A.exports=shelter.solidWeb});var ue={};Y(ue,{onUnload:()=>Te,settings:()=>j});var _=m(a()),y=m(a());var C={[-9]:["AKST"],[-8]:["PST"],[-7]:["MST"],[-6]:["CT","CST"],[-5]:["ET","EST"],[-4]:["EDT"],[-3]:["AMST","ART","BRT","SRT","UYT","WGT"],[-2]:["FNT","PMDT"],[-1]:["AZOT","CVT","EGT"],0:["UTC","GMT","WET"],1:["CET","MET","WAT"],2:["CAT","EET","KALT","SAST","WAST"],3:["AST","EAT","FET","IOT","MSK","TRT"],4:["RET","AMT"],5:["MVT","PKT","TJT","TMT","UZT"],5.5:["IST"],7:["THA","WIB"],8:["AWST","CST","HKT","MST","MYT","SGT","WST"],9:["JST","KST"],9.5:["ACST"],10:["AEST","AET","VLAT"],12:["NZST"]},K=Object.values(C).flat(),L=Object.fromEntries(Object.entries(C).flatMap(([e,t])=>t.map(o=>[o,parseFloat(e)]))),Z=new RegExp(`(${K.join("|")})(?:([+-]\\d+)(?::(\\d+))?)?`),T=e=>{if(!e)return;let t=e.match(Z);if(!t)return;let[,o,n,s]=t;return L[o]+parseFloat(n??0)+parseFloat(s??0)/60};var k="https://timezonedb.catvibers.me/api/user/bulk",q="shelter/0.0.0 timestamptools/1.0.0",p=new Map,S=!1,J=150,u=new Map,V=()=>setTimeout(async()=>{let e=p;p=new Map;let t=JSON.stringify([...e.keys()]);try{let o=await fetch(k,{method:"post",body:t,headers:{"User-Agent":q,"Content-Type":"application/json"}}).then(n=>n.json());for(let n in o)if(e.has(n)&&o[n]){let s=parseFloat(o[n].timezone);e.get(n)?.(s),u.set(n,s)}for(let[n,s]of e.entries())s(),u.set(n,void 0)}finally{S=!1}},J),M=e=>u.has(e)?u.get(e):new Promise(t=>{setTimeout(t,3e3),p.set(e,t),S||(S=!0,V())});var Q=(0,_.template)('<time class="ys_tz"> (Theirs: <!>)</time>',3),{plugin:{store:X},flux:{stores:f},util:{getFiber:ee,reactFiberWalker:te}}=shelter,z=new Set;async function oe(e,t){if(z.has(t))return;let o=te(ee(e),n=>n.stateNode?.handlePreload,!0)?.stateNode;!o||(o.handlePreload(),z.add(t))}var ne=(e,t)=>T(f.UserProfileStore.getUserProfile(e)?.bio)??T(f.UserProfileStore.getGuildMemberProfile(e,t)?.bio)??T(f.NoteStore.getNote(e)?.note),b=new Set,x=e=>!e.parentElement.querySelector(".ys_tz")&&!b.has(e);async function se(e,t){if(X.tzdb){let o=await M(t.author.id);if(o!==void 0)return o}return await oe(e.parentElement.parentElement.querySelector("[id^=message-username]").firstElementChild,t.author.id),ne(t.author.id,f.ChannelStore.getChannel(t.channel_id)?.guild_id)}async function w(e,t,o){b.add(t);let n=await se(t,e);b.delete(t),!(!n||(o.utc(),o.hours(o.hours()+n),Date.now()-Date.parse(o.toISOString())>1e3*60*60*24))&&t.parentElement.append((()=>{let h=Q.cloneNode(!0),v=h.firstChild,E=v.nextSibling,fe=E.nextSibling;return(0,y.insert)(h,()=>o.format("HH:mm"),E),h})())}var{plugin:{store:re}}=shelter,N=e=>e.dataset.abstime!==e.childNodes[1].textContent;function D(e,t){re.absUtc&&t.utc();let o=t.format("YYYY-MM-DD hh:mm:ss");e.dataset.abstime=o,e.childNodes[1].textContent=o}var U=m(a()),c=m(a()),ie=(0,U.template)('<a href="https://timezonedb.catvibers.me/?client_mod=shelter">TZDB</a>',2),{plugin:{store:r},ui:{SwitchItem:d}}=shelter,j=()=>[(0,c.createComponent)(d,{get value(){return r.tz},onChange:e=>r.tz=e,children:"Show users' local time (parses timezones from bios & notes)"}),(0,c.createComponent)(d,{get disabled(){return!r.tz},get value(){return r.tzdb},onChange:e=>r.tzdb=e,get children(){return["Prefer to query",ie.cloneNode(!0)]}}),(0,c.createComponent)(d,{get value(){return r.abs},onChange:e=>r.abs=e,children:"Show times in absolute ISO form (YYYY-MM-DD HH:MM:SS) every time, instead of relative times"}),(0,c.createComponent)(d,{get disabled(){return!r.abs},get value(){return r.absUtc},onChange:e=>r.absUtc=e,children:"Show absolute times in UTC, not local timezone"})];var{plugin:{store:i},flux:{dispatcher:P},observeDom:ae,util:{getFiber:ce,reactFiberWalker:le}}=shelter;i.tz??=!0;i.tzdb??=!0;i.abs??=!1;i.absUtc??=!1;async function me(e){let t=i.tz&&x(e),o=i.abs&&N(e);if(!t&&!o)return;let n=le(ce(e),"message",!0)?.memoizedProps?.message,s=n?.timestamp;!s||(o&&D(e,s.clone()),t&&await w(n,e,s.clone()))}function O(){if(!i.tz&&!i.abs)return;let e=ae("h3 time[id^=message-timestamp]",t=>{e(),me(t)});setTimeout(e,500)}var I=["MESSAGE_CREATE","CHANNEL_SELECT","LOAD_MESSAGES_SUCCESS","UPDATE_CHANNEL_DIMENSIONS","MESSAGE_END_EDIT","MESSAGE_UPDATE"];I.forEach(e=>P.subscribe(e,O));var Te=()=>I.forEach(e=>P.unsubscribe(e,O));return H(ue);})();
