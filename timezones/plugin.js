(()=>{var y=Object.create;var a=Object.defineProperty;var w=Object.getOwnPropertyDescriptor;var I=Object.getOwnPropertyNames;var O=Object.getPrototypeOf,G=Object.prototype.hasOwnProperty;var F=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),R=(e,t)=>{for(var o in t)a(e,o,{get:t[o],enumerable:!0})},d=(e,t,o,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of I(t))!G.call(e,n)&&n!==o&&a(e,n,{get:()=>t[n],enumerable:!(s=w(t,n))||s.enumerable});return e};var f=(e,t,o)=>(o=e!=null?y(O(e)):{},d(t||!e||!e.__esModule?a(o,"default",{value:e,enumerable:!0}):o,e)),W=e=>d(a({},"__esModule",{value:!0}),e);var c=F((se,E)=>{E.exports=shelter.solidWeb});var ee={};R(ee,{onUnload:()=>X,settings:()=>D});var g=f(c()),C=f(c());var b={[-9]:["AKST"],[-8]:["PST"],[-7]:["MST"],[-6]:["CT","CST"],[-5]:["ET","EST"],[-4]:["EDT"],[-3]:["AMST","ART","BRT","SRT","UYT","WGT"],[-2]:["FNT","PMDT"],[-1]:["AZOT","CVT","EGT"],0:["UTC","GMT","WET"],1:["CET","MET","WAT"],2:["CAT","EET","KALT","SAST","WAST"],3:["AST","EAT","FET","IOT","MSK","TRT"],4:["RET","AMT"],5:["MVT","PKT","TJT","TMT","UZT"],5.5:["IST"],7:["THA","WIB"],8:["AWST","CST","HKT","MST","MYT","SGT","WST"],9:["JST","KST"],9.5:["ACST"],10:["AEST","AET","VLAT"],12:["NZST"]},Y=Object.values(b).flat(),$=Object.fromEntries(Object.entries(b).flatMap(([e,t])=>t.map(o=>[o,parseFloat(e)]))),v=new RegExp(`(${Y.join("|")})(?:([+-]\\d+)(?::(\\d+))?)?`),l=e=>{if(!e)return;let t=e.match(v);if(!t)return;let[,o,s,n]=t;return $[o]+parseFloat(s??0)+parseFloat(n??0)/60};var K=(0,g.template)('<time class="ys_tz"> (Theirs: <!>)</time>',3),{flux:{stores:T},util:{getFiber:L,reactFiberWalker:B}}=shelter,A=new Set;async function H(e,t){if(A.has(t))return;let o=B(L(e),s=>s.stateNode?.handlePreload,!0)?.stateNode;!o||(o.handlePreload(),A.add(t))}var Z=(e,t)=>l(T.UserProfileStore.getUserProfile(e)?.bio)??l(T.UserProfileStore.getGuildMemberProfile(e,t)?.bio)??l(T.NoteStore.getNote(e)?.note),S=new Set,M=e=>!e.parentElement.querySelector(".ys_tz")&&!S.has(e);async function x(e,t,o){S.add(t),await H(t.parentElement.parentElement.querySelector("[id^=message-username]").firstElementChild,e.author.id),S.delete(t);let s=Z(e.author.id,T.ChannelStore.getChannel(e.channel_id)?.guild_id);!s||(o.utc(),o.hours(o.hours()+s),Date.now()-Date.parse(o.toISOString())>1e3*60*60*24)||t.parentElement.append((()=>{let u=K.cloneNode(!0),P=u.firstChild,p=P.nextSibling,te=p.nextSibling;return(0,C.insert)(u,()=>o.format("hh:mm"),p),u})())}var{plugin:{store:k}}=shelter,_=e=>e.dataset.abstime!==e.childNodes[1].textContent;function z(e,t){k.absUtc&&t.utc();let o=t.format("YYYY-MM-DD hh:mm:ss");e.dataset.abstime=o,e.childNodes[1].textContent=o}var m=f(c()),{plugin:{store:r},ui:{SwitchItem:h}}=shelter,D=()=>[(0,m.createComponent)(h,{get value(){return r.tz},onChange:e=>r.tz=e,children:"Show users' local time (parses timezones from bios & notes)"}),(0,m.createComponent)(h,{get value(){return r.abs},onChange:e=>r.abs=e,children:"Show times in absolute ISO form (YYYY-MM-DD HH:MM:SS) every time, instead of relative times"}),(0,m.createComponent)(h,{get disabled(){return!r.abs},get value(){return r.absUtc},onChange:e=>r.absUtc=e,children:"Show absolute times in UTC, not local timezone"})];var{plugin:{store:i},flux:{dispatcher:N},observeDom:V,util:{getFiber:q,reactFiberWalker:J}}=shelter;i.tz??=!0;i.abs??=!1;i.absUtc??=!1;async function Q(e){let t=i.tz&&M(e),o=i.abs&&_(e);if(!t&&!o)return;let s=J(q(e),"message",!0)?.memoizedProps?.message,n=s?.timestamp;!n||(o&&z(e,n.clone()),t&&await x(s,e,n.clone()))}function U(){if(!i.tz&&!i.abs)return;let e=V("h3 time[id^=message-timestamp]",t=>{e(),Q(t)});setTimeout(e,500)}var j=["MESSAGE_CREATE","CHANNEL_SELECT","LOAD_MESSAGES_SUCCESS","UPDATE_CHANNEL_DIMENSIONS","MESSAGE_END_EDIT","MESSAGE_UPDATE"];j.forEach(e=>N.subscribe(e,U));var X=()=>j.forEach(e=>N.unsubscribe(e,U));return W(ee);})();
